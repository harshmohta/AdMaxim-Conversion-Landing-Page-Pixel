___TERMS_OF_SERVICE___

By creating or modifying this file you agree to Google Tag Manager's Community
Template Gallery Developer Terms of Service available at
https://developers.google.com/tag-manager/gallery-tos (or such other URL as
Google may provide), as modified from time to time.

___INFO___

{
  "displayName": "AdMaxim Smart Pixel",
  "description": "Use AdMaxim Smart Pixel to easily track your campaign's performance. Smart Pixel can show how many Conversions or Lands on to your website, after clicking on an ad.",
  "categories": ["CONVERSION_TRACKING","ADVERTISING","ANALYTICS"],
  "securityGroups": [],
  "id": "cvt_temp_public_id",
  "type": "TAG",
  "version": 1,
  "brand": {
    "thumbnail": "data:image/png;base64,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",
    "displayName": "",
    "id": "brand_dummy"
  },
  "containerContexts": [
    "WEB"
  ]
}


___TEMPLATE_PARAMETERS___

[
  {
    "help": "Please select either of the Conversion or Landing pixel to track Conversions or Land's on your Website.",
    "displayName": "Tracking Pixel Type",
    "simpleValueType": true,
    "name": "EventType",
    "type": "RADIO",
    "radioItems": [
      {
        "displayValue": "Conversion Pixel",
        "value": "converted"
      },
      {
        "displayValue": "Landing Pixel",
        "value": "cplp"
      }
    ]
  },
  {
    "help": "Please copy & paste comma-separated campaign IDs from AdMaxim Campaign Manager.",
    "valueValidators": [
      {
        "type": "NON_EMPTY"
      },
      {
        "args": [
          "^[0-9,]+$"
        ],
        "type": "REGEX"
      }
    ],
    "displayName": "Campaign ID",
    "simpleValueType": true,
    "name": "CpnId",
    "type": "TEXT",
    "valueHint": "123434,23456,.."
  },
  {
    "macrosInSelect": false,
    "selectItems": [
      {
        "displayValue": "Purchase/Sale",
        "value": "sale"
      },
      {
        "displayValue": "Leads",
        "value": "lead"
      },
      {
        "displayValue": "Promotions",
        "value": "promo"
      },
      {
        "displayValue": "Subscriptions",
        "value": "subscribe"
      },
      {
        "displayValue": "Signups",
        "value": "register"
      },
      {
        "displayValue": "Important",
        "value": "important"
      },
      {
        "displayValue": "Page1",
        "value": "page1"
      },
      {
        "displayValue": "Page2",
        "value": "page2"
      },
      {
        "displayValue": "Page3",
        "value": "page3"
      },
      {
        "displayValue": "Page4",
        "value": "page4"
      }
    ],
    "displayName": "Conversion Type",
    "defaultValue": "lead",
    "simpleValueType": true,
    "name": "ConversionType",
    "type": "SELECT"
  }
]


___WEB_PERMISSIONS___

[
  {
    "instance": {
      "key": {
        "publicId": "logging",
        "versionId": "1"
      },
      "param": [
        {
          "key": "environments",
          "value": {
            "type": 1,
            "string": "debug"
          }
        }
      ]
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "get_referrer",
        "versionId": "1"
      },
      "param": [
        {
          "key": "urlParts",
          "value": {
            "type": 1,
            "string": "any"
          }
        },
        {
          "key": "queriesAllowed",
          "value": {
            "type": 1,
            "string": "any"
          }
        }
      ]
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "send_pixel",
        "versionId": "1"
      },
      "param": [
        {
          "key": "urls",
          "value": {
            "type": 2,
            "listItem": [
              {
                "type": 1,
                "string": "https://track.admaxim.com/*"
              }
            ]
          }
        }
      ]
    },
    "clientAnnotations": {
      "isEditedByUser": true
    },
    "isRequired": true
  },
  {
    "instance": {
      "key": {
        "publicId": "get_url",
        "versionId": "1"
      },
      "param": [
        {
          "key": "urlParts",
          "value": {
            "type": 1,
            "string": "any"
          }
        },
        {
          "key": "queriesAllowed",
          "value": {
            "type": 1,
            "string": "any"
          }
        }
      ]
    },
    "isRequired": true
  }
]


___SANDBOXED_JS_FOR_WEB_TEMPLATE___

// API's
const log = require('logToConsole');
const sendPixel = require('sendPixel');
const getReferrerUrl = require('getReferrerUrl');
const queryPermission = require('queryPermission');
const encodeUriComponent = require('encodeUriComponent');
const getUrl = require('getUrl');
const getTimestamp = require('getTimestamp');
const getReferrerQueryParameters = require('getReferrerQueryParameters');
const getQueryParameters = require('getQueryParameters');
const makeString = require('makeString');

//variable's 
const EventType = data.EventType;
const CpnId = data.CpnId;
const ConversionType = data.ConversionType;
const referrer = getReferrerUrl(undefined);
let trackingUrl;
var clickId = getQueryParameters('clickId');
var refClickID = getReferrerQueryParameters('clickId');
var id='';

var searchTerm = "ADMC-";

if(clickId !== undefined || refClickID !== undefined ){
	if(clickId.indexOf(searchTerm) === 0)
      id = getQueryParameters('clickId');
	else if(refClickID.indexOf(searchTerm) === 0)
      id = getReferrerQueryParameters('clickId');
}

if(EventType == 'cplp'){
	 trackingUrl = 'https://track.admaxim.com/adtracker/track/track/cplp?id='+encodeUriComponent(makeString(id))+'&cpnIds='+encodeUriComponent(CpnId)+'&eventType='+encodeUriComponent(ConversionType)+'&ts='+encodeUriComponent(makeString(getTimestamp()))+'&ref='+encodeUriComponent(referrer)+'&url='+encodeUriComponent(getUrl());
}
else{
	trackingUrl = 'https://track.admaxim.com/adtracker/track/track/converted?id='+encodeUriComponent(makeString(id))+'&conversionType='+encodeUriComponent(ConversionType)+'&cpnIds='+encodeUriComponent(CpnId)+'&ts='+encodeUriComponent(makeString(getTimestamp()))+'&ref='+encodeUriComponent(referrer)+'&url='+encodeUriComponent(getUrl());
}

sendPixel(trackingUrl,data.gtmOnSuccess,data.gtmOnFailure,EventType);

log("id="+id+","+"cpnIds="+encodeUriComponent(CpnId)+","+"eventType="+encodeUriComponent(ConversionType)+","+"ts="+encodeUriComponent(makeString(getTimestamp()))+","+"ref="+encodeUriComponent(referrer)+","+"url="+encodeUriComponent(getUrl()));
log('data =', data);


___NOTES___

Created on 18/09/2019, 12:05:20
